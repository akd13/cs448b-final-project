<head>
  <style> body { margin: 0; } </style>

  <script src="//unpkg.com/react/umd/react.production.min.js"></script>
  <script src="//unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
  <script src="//unpkg.com/@babel/standalone"></script>

  <script src="//unpkg.com/d3"></script>
  <script src="//unpkg.com/d3-dsv"></script>

  <script src="//unpkg.com/react-globe.gl"></script>
  <!--<script src="../../dist/react-globe.gl.js"></script>-->
</head>

<body>
<div id="globeViz"></div>

<script type="text/jsx">
  const { useState, useEffect, useRef } = React;

  const World = () => {
    const globeEl = useRef();
    const [popData, setPopData] = useState([]);
    const [tooltip, setTooltip] = useState({ display: false, message: '', x: 0, y: 0 });

    useEffect(() => {
      // load data
      fetch('world_population.csv').then(res => res.text())
        .then(csv => d3.csvParse(csv, ({ lat, lng, pop }) => ({ lat: +lat, lng: +lng, pop: +pop })))
        .then(setPopData);
    }, []);

    useEffect(() => {
      // Auto-rotate
      globeEl.current.controls().autoRotate = true;
      globeEl.current.controls().autoRotateSpeed = 0.0;
    }, []);

    const weightColor = d3.scaleSequentialSqrt(d3.interpolateYlOrRd)
      .domain([0, 1e7]);

      const handlePolygonHover = (polygon, latLng, event) => {
      if (polygon) {
        setTooltip({
          display: true,
          message: 'hello',
          x: event.clientX,
          y: event.clientY
        });
      } else {
        setTooltip({ ...tooltip, display: false });
      }
    };

  return (
    <div>
      {tooltip.display && (
        <div style={{ position: 'absolute', left: tooltip.x, top: tooltip.y, color: 'white', background: 'rgba(0,0,0,0.5)', padding: '5px', borderRadius: '5px' }}>
          {tooltip.message}
        </div>
      )}
      <Globe
        ref={globeEl}
        globeImageUrl="//unpkg.com/three-globe/example/img/earth-night.jpg"
        bumpImageUrl="//unpkg.com/three-globe/example/img/earth-topology.png"
        backgroundImageUrl="//unpkg.com/three-globe/example/img/night-sky.png"
        hexBinPointsData={popData}
        hexBinPointWeight="pop"
        hexAltitude={0}
        hexBinResolution={4}
        hexTopColor={d => weightColor(d.sumWeight)}
        hexSideColor={d => weightColor(d.sumWeight)}
        hexBinMerge={true}
        onHexPolygonHover={handlePolygonHover}
        enablePointerInteraction={true}
        />
      </div>
    );
  };

  ReactDOM.render(
    <World />,
    document.getElementById('globeViz')
  );
</script>
</body>